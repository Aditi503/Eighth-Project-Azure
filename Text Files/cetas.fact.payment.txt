IF OBJECT_ID('dbo.fact_payment') IS NOT NULL
    DROP EXTERNAL TABLE [dbo].[fact_payment];
GO

CREATE EXTERNAL TABLE dbo.fact_payment
WITH (
    LOCATION    = 'star_schema/fact_payment',
    DATA_SOURCE = [eighthprojectfilesystem_eighthprojectaccount_dfs_core_windows_net],
    FILE_FORMAT = [SynapseDelimitedTextFormat]
)  
AS
SELECT 
    [payment_id],
    [amount],
    CAST([date] AS DATETIME2) AS [payment_date],
    [rider_id] AS [rider_key]
FROM OPENROWSET(
    BULK 'Staging_Payments.csv', 
    DATA_SOURCE = 'eighthprojectfilesystem_eighthprojectaccount_dfs_core_windows_net',
    FORMAT = 'CSV',
    PARSER_VERSION = '2.0',
    FIRSTROW = 2
) 
WITH (
    [payment_id] INT,
    [date] VARCHAR(50) COLLATE Latin1_General_100_BIN2_UTF8,
    [amount] DECIMAL(18,2),
    [rider_id] INT
) AS [payments];
GO

SELECT TOP 50 * FROM dbo.fact_payment;